<!DOCTYPE html>
<html>
  <head>
    <title>ThoughtWorksNYC | Home Office Day</title>
    <link rel="stylesheet" href="//showcase.thoughtworks.com/css/candy.css">
  </head>
  <body>
    <div id="container">
      <div class="grid-wrapper">
        <div class="grid">
          <div class="grid__cell">
            <br/>
            <p>NYC::HOD -- Angular JS Dark Magic</p>
          </div>
        </div>
      </div>
      <div class="grid-wrapper insights-article insights-article--blue">
        <div class="grid">
          <div class="grid__cell">
            <p class="insights-article__date">March 21, 2014</p>
            <h2 class="insights-article__title">
              We've all written code<br/> 
              we're not proud of...
            </h2>
            <p class="insights-article__categories">
              <a href="http://www.arable.me/">For those interested...</a>
            </p>
          </div>
        </div>
      </div>
      <div class="new-york__subtitle">
        <pre>
          var queue = ...        // A job queue out in space

          var data_services    = [analyticsService, mailerService, ..., anyOtherServices];
          var service_results  = [];
          var api_results      = [];

          queue.poll('aQueue', function(err, data) {
            if(err) {
              return processErrorMessage(err);
            }
            else {
              response = JSON.parse(data);
              data_services.forEach(function(data_service) { // CALL BACK - For each data service
                data_service.do_work(data, function(result) { // CALL BACK - Do some work
                  results.push(result);
                  if(results.length == data_services.length) {
                    results.forEach(function(result) { // CALL BACK - Do some API calls when all work is done
                      different_ap_call(result, function(err, data) { // CALL BACK
                        if(err) {
                          return processErrorMessage(err);
                        } else {
                          api_results.push(data);
                          if(api_results.length == results.length) {
                            queue.deleteMessage('aQueue', response.messageId);
                          }
                        }
                      });
                    });
                  }
                });
              });
            }
          });
        </pre>
    </div>
    <div class="grid-wrapper insights-article insights-article--blue">
      <div class="grid">
        <div class="grid__cell">
          <p class="insights-article__categories">
            <br/>
            <a href="/index4.html" class="insights-article__category">But there is another way.</a>
          </p>
        </div>
      </div>
    </div>
  </body>
</html>